/*!
 * github.js - v0.1.1
 * Copyright (c) 2015-2015 Akshay Sharma  <sharmakumar3092@gmail.com>
 */
!function(a,b){"function"==typeof define&&define.amd?define(["underscore"],b):"object"==typeof exports?module.exports=b(require("underscore")):a.Github=b(a._)}(this,function(a){var b={};b.version="0.1.1";var c="https://api.github.com/",d={userProfileTpl:'<div class="gt-usr-header gt-shadow"><div class="gt-usr-avatar"><a target="_blank" href="<%= html_url%>"><div class="gt-usr-img" style="background-image: url(<%= avatar_url%>)"> </div></a></div><div class="gt-usr-name"><span class="user-name"><%= name%></span><a target="_blank" href="<%= html_url%>"><span class="user-login"><%= login%></span></a></div><div class="gt-usr-details"><div class="gt-usr-repo"><a target="_blank" href="<%= html_url%>"><span class="gt-usr-txt"><%= public_repos%></span><span class="gt-usr-dt">Repositories</span></a></div><div class="gt-usr-folwr"><a target="_blank" href="<%= html_url + "/followers"%>"><span class="gt-usr-txt"><%= followers%></span><span class="gt-usr-dt">Followers</span></a></div><div class="gt-usr-folng"><a target="_blank" href="<%= html_url + "/following"%>"><span class="gt-usr-txt"><%= following%></span><span class="gt-usr-dt">Following</span></a></div></div></div>',repoProfileTpl:'<div class="gt-usr-header gt-shadow"><div class="gt-usr-name"><span class="user-name"><%= name%></span><a target="_blank" href="<%= owner.html_url%>"><span class="user-login"><%= owner.login%></span></a><p><%= description%></p></div><div class="gt-usr-details"><div class="gt-usr-repo"><a target="_blank" href="<%= html_url%>"><span class="gt-usr-txt"><%= stargazers_count%></span><span class="gt-usr-dt">Stars</span></a></div><div class="gt-usr-folwr"><a target="_blank" href="<%= html_url %>"><span class="gt-usr-txt"><%= subscribers_count%></span><span class="gt-usr-dt">Watchers</span></a></div><div class="gt-usr-folng"><a target="_blank" href="<%= html_url %>"><span class="gt-usr-txt"><%= forks_count%></span><span class="gt-usr-dt">Forks</span></a></div><div class="gt-repo-lg-stat"><%= languageHtml %></div></div></div>',orgProfileTpl:'<div class="gt-org-header gt-shadow"><div class="gt-org-avatar"><a target="_blank" href="<%= html_url%>"><div class="gt-org-img" style="background-image: url(<%= avatar_url%>)"> </div></a></div><div class="gt-org-name"><span class="user-name"><%= name%></span><%if(blog){%><a target="_blank" href="<%= blog%>" class="gt-org-link"><span class="user-login">Website</span></a><%}%><%if(email){%><a target="_blank" href="mailto:<%= email%>" class="gt-org-link"><span class="user-login">Email</span></a><%}%><br><span class="gt-org-repos"><%= public_repos%></span><span class="gt-org-repos"> Public Repositories</span></div></div>',gitActivityTpl:'<div class="gt-activity <%=type%>"><div class="gt-avatar-cnt"><a target="_blank" href="https://github.com/<%= actor.login%>"><img src="<%=actor.avatar_url%>" class="gt-usr-avatar"></a></div><div class="gt-act-cnt"><div title="<%= created_at%>" class="gt-time-cnt"><div class="gt-time-str"><%= timeString%></div></div><%= userLink%><%= message%></div><div class="gt-clearfix"></div></div>',CommitCommentEvent:"<span> commented on commit <%= commentLink%> </span><p><%= payload.comment.body%></p>",CreateEvent:"<span> created <%= payload.ref_type%> <%= branchLink%> at <%= repoLink%> </span>",DeleteEvent:"<span> deleted <%= payload.ref%> <%= payload.ref_type%> at <%= repoLink%> </span>",ForkEvent:"<span> forked <%= repoLink%> to <%= forkLink%> </span>",GollumEvent:"<span> <%= actionType%> the <%= repoLink%> wiki</span><p><%= wikiMessage%></p>",IssueCommentEvent:"<span> commented on issue <%= commentLink%> </span><p><%= payload.comment.body%></p>",IssuesEvent:"<span> <%= payload.action%> issue <%= issueUrl%> </span>",MemberEvent:"<span> added <%= memberLink%> to <%= repoLink%> </span>",PublicEvent:"<span> open sourced <%= repoLink%> </span>",PullRequestEvent:'<span> <%= payload.action%> pull request <%= mergeRequestUrl%> </span><p><%= payload.pull_request.title%></p><p class="pull-req-info"><%= payload.pull_request.commits%><%if(payload.pull_request.commits > 1){%> commits <%}else{%> commit <%}%> with <%= payload.pull_request.changed_files%> <%if(payload.pull_request.commits > 1){%> files <%}else{%> file <%}%> changed.</p>',PullRequestReviewCommentEvent:"<span> commented on pull request <%= pullCommentUrl%> </span><p><%= payload.comment.body%></p>",PushEvent:"<span> pushed to <%= branchLink%> at <%= repoLink%> </span><%= commitsHtml%>",ReleaseEvent:"<span> released <%= tagLink%> at <%= repoLink%> </span><br><%= zipLink%>",WatchEvent:"<span> starred <%= repoLink%> </span>",noActivityTpl:'<div class="gt-no-activity"><span> There are no public events for this account in past 90 days. </span></div>',notFoundTpl:'<div class="gt-no-activity"><span> This account does not exist. </span></div>'},e={checkInteger:function(a){return a===parseInt(a,10)?!0:!1},getRenderedHTML:function(b,c){return c?a.template(b)(c):a.template(b)()},getUserProfileHTML:function(a){var b=c+"users/"+a;return e.getData(b,function(a){return e.getRenderedHTML(d.userProfileTpl,a)})},getRepoProfileHTML:function(a,b){var f=c+"repos/"+a+"/"+b,g=f+"/languages",h=e.getData(g,e.getLanguageHTML);return e.getData(f,function(a){return a.languageHtml=h,e.getRenderedHTML(d.repoProfileTpl,a)})},getOrgProfileHTML:function(a){var b=c+"orgs/"+a;return e.getData(b,function(a){return e.getRenderedHTML(d.orgProfileTpl,a)})},getPublicActivityHTML:function(a){var b='<div class="gt-activity-cnt gt-scrollbar">',c=e.activityLimit<a.length?e.activityLimit:a.length;if(0==c)b+=e.getRenderedHTML(d.noActivityTpl);else for(var f=0;c>f;f++){var g=a[f],h=g.payload;switch(g.timeString=e.millisecondsToStr(new Date-new Date(g.created_at)),g.userLink=e.getGitHubLink(g.actor.login,g.actor.login),g.repoLink=e.getGitHubLink(g.repo.name,g.repo.name),g.branchLink="",h.ref&&(g.branch="refs/heads/"===h.ref.substring(0,11)?h.ref.substring(11):h.ref,g.branchLink=e.getGitHubLink(g.repo.name+"/tree/"+g.branch,g.branch)),g.type){case"CommitCommentEvent":g.commentLink=e.getLink(h.comment.html_url,g.repo.name+"@"+h.comment.commit_id.substring(0,6));break;case"CreateEvent":break;case"DeleteEvent":break;case"ForkEvent":g.forkLink=e.getGitHubLink(h.forkee.html_url,h.forkee.full_name);break;case"GollumEvent":var i=h.pages[0];g.actionType=i.action,g.wikiMessage=g.actionType.charAt(0).toUpperCase()+g.actionType.slice(1)+" ",g.wikiMessage+=e.getLink(i.html_url,i.title);break;case"IssueCommentEvent":g.commentLink=e.getLink(h.comment.html_url,g.repo.name+"#"+h.issue.number);break;case"IssuesEvent":g.issueUrl=e.getLink(h.issue.html_url,g.repo.name+"#"+h.issue.number);break;case"MemberEvent":g.memberLink=e.getGitHubLink(h.member.login,h.member.login);break;case"PublicEvent":break;case"PullRequestEvent":g.mergeRequestUrl=e.getLink(h.pull_request.html_url,g.repo.name+"#"+h.pull_request.number);break;case"PullRequestReviewCommentEvent":g.pullCommentUrl=e.getLink(h.comment.html_url,g.repo.name+"#"+h.pull_request.number);break;case"PushEvent":g.commitsHtml=e.getCommitsHTML(g);break;case"ReleaseEvent":g.tagLink=e.getLink(h.release.html_url,h.release.tag_name),g.zipLink=e.getLink(h.release.zipball_url,"Download Source Code (zip)");break;case"WatchEvent":}g.message=e.getRenderedHTML(d[g.type],g),b+=e.getRenderedHTML(d.gitActivityTpl,g)}return b+="</div>"},getCommitsHTML:function(a){var b,c,d,f,g,h='<ul class="gt-commit-list">',i="",j=a.payload,k=j.commits.length,l=j.before+"..."+j.head;for(g=0;k>g&&!(g>1);g++)f=j.commits[g],b='<li class="gt-commit-item" >',c=e.getGitHubLink(a.repo.name+"/commit/"+f.sha,f.sha.substring(0,6)),d='<span class="gt-commit-msg">'+f.message.substring(0,150)+"</span>",b+=c,b+=d,b+="</li>",h+=b;return 2===k?i=e.getGitHubLink(a.repo.name+"/compare/"+l,"View comparison for these 2 commits &raquo;","gt-compare-link"):k>2&&(i=e.getGitHubLink(a.repo.name+"/compare/"+l,k-2+" more "+e.getPluralWord(k-2,"commit")+" &raquo;","gt-compare-link")),h+="</ul>",h+=i},getData:function(a,b){var c,d,e;return e=new XMLHttpRequest,e.open("GET",a,!1),e.onload=function(){return e.status>=200&&e.status<400?(d=JSON.parse(e.responseText),void(c=b(d))):!1},e.onerror=function(){console.log("An error occurred while connecting to GitHub API.")},e.send(),c},getLink:function(a,b,c){return b||(b=a),"undefined"==typeof c&&(c=""),e.getRenderedHTML('<a class="'+c+'" href="<%=url%>" target="_blank"><%=title%></a>',{url:a,title:b})},getGitHubLink:function(a,b,c){return b||(b=a),"undefined"==typeof c&&(c=""),e.getLink("https://github.com/"+a,b,c)},getPluralWord:function(a,b){return 1!==a?b+"s":b},getLanguageHTML:function(b){var c,d=[],f=0,g="";return a.each(b,function(a,b){var c={};c.language=b,c.size=a,d.push(c),f+=a}),d=d.sort(function(a,b){return b.size-a.size}),a.each(d,function(a){c=(parseInt(a.size)/f*100).toFixed(1),g+='<div class="gt-repo-lg-cnt" style="width: '+c+"%; background: #"+e.getRandomColor()+'; " > <div class="gt-repo-lg-name" data-title="'+a.language+" ("+c+'%)"> </div> </div>'}),g},getRandomColor:function(){return Math.random().toString(16).substring(2,8)},millisecondsToStr:function(a){function b(a){return a>1?"s ago":" ago"}var c=Math.floor(a/1e3),d=Math.floor(c/31536e3);if(d)return d+" year"+b(d);var e=Math.floor((c%=31536e3)/2592e3);if(e)return e+" month"+b(e);var f=Math.floor((c%=2592e3)/86400);if(f)return f+" day"+b(f);var g=Math.floor((c%=86400)/3600);if(g)return"about "+g+" hour"+b(g);var h=Math.floor((c%=3600)/60);if(h)return h+" minute"+b(h);var i=c%60;return i?i+" second"+b(i):"just now"},renderContent:function(a,b){var c=document.querySelectorAll(b);a='<div class="gt-container">'+a+"</div>";for(var d=0;d<c.length;d++)c[d].innerHTML=a,c[d].style.position="relative"},setLimit:function(a){var b;e.activityLimit="undefined"!==a&&e.checkInteger(b=parseInt(a,10))?b>30?30:b:30}};return b.userProfile=function(a){if(!a.username||!a.selector)return!1;var b="",c=e.getUserProfileHTML(a.username);b+=c?c:e.getRenderedHTML(d.notFoundTpl),e.renderContent(b,a.selector)},b.repoProfile=function(a){if(!a.username||!a.selector||!a.reponame)return!1;var b="",c=e.getRepoProfileHTML(a.username,a.reponame);b+=c?c:e.getRenderedHTML(d.notFoundTpl),e.renderContent(b,a.selector)},b.orgProfile=function(a){if(!a.orgname||!a.selector)return!1;var b="",c=e.getOrgProfileHTML(a.orgname);b+=c?c:e.getRenderedHTML(d.notFoundTpl),e.renderContent(b,a.selector)},b.userActivity=function(a){if(!a.username||!a.selector)return!1;e.setLimit(a.limit);var b=c+"users/"+a.username+"/events",f="",g=e.getUserProfileHTML(a.username);g?(f+=g,eventHtml=e.getData(b,e.getPublicActivityHTML),f+=eventHtml):f+=e.getRenderedHTML(d.notFoundTpl),e.renderContent(f,a.selector)},b.repoActivity=function(a){if(!a.username||!a.selector||!a.reponame)return!1;e.setLimit(a.limit);var b=c+"repos/"+a.username+"/"+a.reponame+"/events",f="",g=e.getRepoProfileHTML(a.username,a.reponame);g?(f+=g,eventHtml=e.getData(b,e.getPublicActivityHTML),f+=eventHtml):f+=e.getRenderedHTML(d.notFoundTpl),e.renderContent(f,a.selector)},b.orgActivity=function(a){if(!a.orgname||!a.selector)return!1;e.setLimit(a.limit);var b=c+"orgs/"+a.orgname+"/events",f="",g=e.getOrgProfileHTML(a.orgname);g?(f+=g,eventHtml=e.getData(b,e.getPublicActivityHTML),f+=eventHtml):f+=e.getRenderedHTML(d.notFoundTpl),e.renderContent(f,a.selector)},b});